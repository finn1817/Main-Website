<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>The Discovery Chamber</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    /* Discovery theme color system */
    --primary: #10b981;
    --primary-light: #34d399;
    --primary-dark: #047857;
    --accent: #f59e0b;
    --surface: #064e3b;
    --surface-light: rgba(6, 78, 59, 0.8);
    --surface-border: rgba(52, 211, 153, 0.2);
    --text: #f0fdf4;
    --text-muted: #a7f3d0;
    --text-dim: #6ee7b7;
    --success: #22c55e;
    --warning: #f59e0b;
    
    /* Spacing */
    --space-xs: 0.5rem;
    --space-sm: 1rem;
    --space-md: 1.5rem;
    --space-lg: 2rem;
    --space-xl: 3rem;
    
    /* Radius */
    --radius-sm: 0.5rem;
    --radius-md: 1rem;
    --radius-lg: 1.5rem;
    --radius-full: 9999px;
    
    /* Shadows */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    --shadow-glow: 0 0 25px rgb(16 185 129 / 0.4);
    
    /* Transitions */
    --ease-out: cubic-bezier(0.4, 0, 0.2, 1);
    --ease-in-out: cubic-bezier(0.4, 0, 0.6, 1);
  }
  
  * { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #0c4a3e 0%, #064e3b 50%, #022c22 100%);
    color: var(--text);
    min-height: 100vh;
    display: grid;
    place-items: center;
    overflow: hidden;
    -webkit-font-smoothing: antialiased;
    position: relative;
  }
  
  /* Code rain background */
  canvas#codeRain { 
    position: absolute; 
    inset: 0; 
    width: 100%; 
    height: 100%; 
    pointer-events: none; 
    opacity: 0.4;
  }
  
  /* Main container */
  .discovery-container {
    position: relative;
    max-width: 30rem;
    width: 90%;
    padding: var(--space-xl);
    background: var(--surface-light);
    backdrop-filter: blur(20px);
    border: 1px solid var(--surface-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl), var(--shadow-glow);
    text-align: center;
  }
  
  /* Discovery visualization */
  .discovery-visual {
    position: relative;
    width: 14rem;
    height: 14rem;
    margin: 0 auto var(--space-lg);
  }
  
  .discovery-hexagon {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 80%;
    height: 80%;
    transform: translate(-50%, -50%);
    clip-path: polygon(30% 0%, 70% 0%, 100% 50%, 70% 100%, 30% 100%, 0% 50%);
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    animation: discovery-rotate 15s linear infinite;
  }
  
  .discovery-core {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 40%;
    height: 40%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
    border-radius: var(--radius-full);
    animation: discovery-pulse 2s ease-in-out infinite;
  }
  
  .discovery-orbit {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120%;
    height: 120%;
    transform: translate(-50%, -50%);
    border: 2px solid var(--primary);
    border-radius: var(--radius-full);
    opacity: 0.3;
    animation: discovery-orbit 20s linear infinite reverse;
  }
  
  .discovery-orbit:nth-child(4) {
    width: 140%;
    height: 140%;
    border-color: var(--accent);
    animation-duration: 25s;
    animation-direction: normal;
  }
  
  .discovery-glow {
    position: absolute;
    inset: -1.5rem;
    background: radial-gradient(circle, var(--primary) 0%, transparent 60%);
    border-radius: var(--radius-full);
    opacity: 0.4;
    animation: discovery-glow 3s ease-in-out infinite alternate;
  }
  
  @keyframes discovery-rotate {
    to { transform: translate(-50%, -50%) rotate(360deg); }
  }
  
  @keyframes discovery-pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
  }
  
  @keyframes discovery-orbit {
    to { transform: translate(-50%, -50%) rotate(360deg); }
  }
  
  @keyframes discovery-glow {
    0% { opacity: 0.3; }
    100% { opacity: 0.5; }
  }
  
  /* Typography */
  .discovery-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: var(--space-xs);
    background: linear-gradient(90deg, var(--text), var(--primary-light));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.025em;
  }
  
  .discovery-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: var(--surface);
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    border-radius: var(--radius-full);
    margin-bottom: var(--space-md);
    box-shadow: var(--shadow-md);
    animation: badge-pulse 2s ease-in-out infinite;
  }
  
  .discovery-badge::before {
    content: 'üéØ';
    font-size: 1rem;
  }
  
  @keyframes badge-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
  
  .discovery-description {
    color: var(--text-muted);
    line-height: 1.6;
    margin-bottom: var(--space-md);
    font-size: 0.95rem;
  }
  
  .discovery-description strong {
    color: var(--text);
    font-weight: 600;
  }
  
  /* Achievement section */
  .achievement-section {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid var(--surface-border);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    margin: var(--space-md) 0;
  }
  
  .achievement-icon {
    font-size: 2rem;
    margin-bottom: var(--space-sm);
  }
  
  .achievement-title {
    color: var(--primary-light);
    font-size: 0.9rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: var(--space-xs);
  }
  
  .achievement-subtitle {
    color: var(--text-dim);
    font-size: 0.8rem;
    opacity: 0.9;
  }
  
  /* Action buttons */
  .discovery-actions {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    margin-top: var(--space-lg);
  }
  
  .action-btn {
    padding: 1rem 1.5rem;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s var(--ease-out);
    position: relative;
    overflow: hidden;
  }
  
  .action-btn.primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: var(--surface);
    box-shadow: var(--shadow-md);
  }
  
  .action-btn.secondary {
    background: linear-gradient(135deg, var(--accent), #d97706);
    color: var(--surface);
    box-shadow: var(--shadow-md);
  }
  
  .action-btn.ghost {
    background: transparent;
    border: 1px solid var(--surface-border);
    color: var(--text-muted);
  }
  
  .action-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  
  .action-btn.primary:hover {
    box-shadow: var(--shadow-lg), 0 0 30px rgba(16, 185, 129, 0.5);
  }
  
  .action-btn.secondary:hover {
    box-shadow: var(--shadow-lg), 0 0 30px rgba(245, 158, 11, 0.5);
  }
  
  .action-btn.ghost:hover {
    background: rgba(52, 211, 153, 0.1);
    color: var(--text);
  }
  
  .action-btn:active {
    transform: translateY(0);
  }
  
  /* Footer */
  .discovery-footer {
    margin-top: var(--space-lg);
    padding-top: var(--space-md);
    border-top: 1px solid var(--surface-border);
    color: var(--text-dim);
    font-size: 0.75rem;
    opacity: 0.9;
  }
  
  /* Responsive design */
  @media (max-width: 640px) {
    .discovery-container {
      padding: var(--space-lg);
      width: 95%;
    }
    
    .discovery-visual {
      width: 12rem;
      height: 12rem;
    }
    
    .discovery-title {
      font-size: 1.75rem;
    }
    
    .discovery-actions {
      gap: 0.75rem;
    }
  }
  
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .discovery-hexagon,
    .discovery-core,
    .discovery-orbit,
    .discovery-glow,
    .discovery-badge {
      animation: none;
    }
  }
</style>
</head>
<body>
  <canvas id="codeRain" aria-hidden="true"></canvas>
  
  <main class="discovery-container">
    <!-- Discovery Visualization -->
    <div class="discovery-visual">
      <div class="discovery-glow"></div>
      <div class="discovery-orbit"></div>
      <div class="discovery-orbit"></div>
      <div class="discovery-hexagon"></div>
      <div class="discovery-core"></div>
    </div>
    
    <!-- Content -->
    <h1 class="discovery-title">Discovery Achieved</h1>
    <div class="discovery-badge">Master Detective</div>
    
    <p class="discovery-description">
      Exceptional! You discovered the <strong>triple-click protocol</strong> on the cursor tracker. Your analytical skills have unlocked this elite discovery chamber.
    </p>
    
    <!-- Achievement Section -->
    <div class="achievement-section">
      <div class="achievement-icon">üèÜ</div>
      <div class="achievement-title">Achievement Unlocked</div>
      <div class="achievement-subtitle">
        Advanced Pattern Recognition ‚Ä¢ Sequence Complete
      </div>
    </div>
    
    <!-- Actions -->
    <div class="discovery-actions">
      <button class="action-btn primary" onclick="window.location.href='index.html'">
        Return to Surface
      </button>
      <button class="action-btn secondary" onclick="window.location.href='portal.html'">
        Previous Gateway
      </button>
      <button class="action-btn ghost" onclick="window.location.href='congrats.html'">
        View Discovery Log
      </button>
    </div>
    
    <div class="discovery-footer">
      Protocol: Triple-Click Discovery ‚Ä¢ Maximum Clearance Achieved üéâ
    </div>
  </main>

  <script>
    // Memory Management System
    const memoryManager = {
      animationFrames: new Set(),
      timeouts: new Set(),
      intervals: new Set(),
      eventListeners: new Map(),
      isCleanedUp: false,
      
      addAnimationFrame(id) {
        this.animationFrames.add(id);
        return id;
      },
      
      addTimeout(id) {
        this.timeouts.add(id);
        return id;
      },
      
      addInterval(id) {
        this.intervals.add(id);
        return id;
      },
      
      addEventListener(element, event, handler, options) {
        if (!this.eventListeners.has(element)) {
          this.eventListeners.set(element, []);
        }
        this.eventListeners.get(element).push({ event, handler, options });
        element.addEventListener(event, handler, options);
      },
      
      cleanup() {
        if (this.isCleanedUp) return;
        
        console.log('üßπ Discovery chamber cleanup initiated - removing animations and event listeners');
        
        // Cancel all animation frames
        this.animationFrames.forEach(id => cancelAnimationFrame(id));
        this.animationFrames.clear();
        
        // Clear all timeouts
        this.timeouts.forEach(id => clearTimeout(id));
        this.timeouts.clear();
        
        // Clear all intervals
        this.intervals.forEach(id => clearInterval(id));
        this.intervals.clear();
        
        // Remove all event listeners
        this.eventListeners.forEach((listeners, element) => {
          listeners.forEach(({ event, handler, options }) => {
            element.removeEventListener(event, handler, options);
          });
        });
        this.eventListeners.clear();
        
        // Stop CSS animations
        const animatedElements = document.querySelectorAll('.discovery-hexagon, .discovery-core, .discovery-orbit, .discovery-glow, .discovery-badge');
        animatedElements.forEach(el => {
          el.style.animation = 'none';
          el.style.transform = 'none';
        });
        
        // Clear code rain canvas
        const canvas = document.getElementById('codeRain');
        if (canvas) {
          const ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        // Remove any dynamic DOM elements
        const flashElements = document.querySelectorAll('[data-temp-element]');
        flashElements.forEach(el => el.remove());
        
        this.isCleanedUp = true;
        console.log('‚úÖ Discovery chamber cleanup completed - all resources freed');
      }
    };
    
    // Auto-cleanup after 10 seconds
    const cleanupTimeout = memoryManager.addTimeout(
      setTimeout(() => memoryManager.cleanup(), 10000)
    );
    
    // Cleanup on page unload
    memoryManager.addEventListener(window, 'beforeunload', () => memoryManager.cleanup());
    
    // Cleanup on visibility change (tab switch)
    memoryManager.addEventListener(document, 'visibilitychange', () => {
      if (document.hidden) {
        memoryManager.cleanup();
      }
    });

    // Interactive discovery hexagon tilt
    const hexagon = document.querySelector('.discovery-hexagon');
    const container = document.querySelector('.discovery-container');
    let rect;
    
    function updateRect(){ 
      if (memoryManager.isCleanedUp) return;
      rect = container.getBoundingClientRect(); 
    }
    updateRect();
    memoryManager.addEventListener(window, 'resize', updateRect);
    
    const pointerMoveHandler = (e) => {
      if (memoryManager.isCleanedUp || !rect) return;
      const x = (e.clientX - rect.left)/rect.width - 0.5;
      const y = (e.clientY - rect.top)/rect.height - 0.5;
      hexagon.style.transform = `translate(-50%, -50%) rotateX(${(-y*10).toFixed(2)}deg) rotateY(${(x*10).toFixed(2)}deg) rotateZ(${(x*5).toFixed(2)}deg)`;
    };
    
    const pointerLeaveHandler = () => { 
      if (memoryManager.isCleanedUp) return;
      hexagon.style.transform = 'translate(-50%, -50%)'; 
    };
    
    memoryManager.addEventListener(document, 'pointermove', pointerMoveHandler);
    memoryManager.addEventListener(document, 'pointerleave', pointerLeaveHandler);

    // Enhanced code rain effect with cleanup
    const canvas = document.getElementById('codeRain');
    const ctx = canvas.getContext('2d');
    let drops = [];
    let codeRainAnimationId = null;
    
    function resizeCanvas(){ 
      if (memoryManager.isCleanedUp) return;
      canvas.width = innerWidth; 
      canvas.height = innerHeight; 
      initDrops();
    }
    
    function initDrops(){
      if (memoryManager.isCleanedUp) return;
      drops = [];
      const columns = Math.floor(canvas.width / 25);
      const chars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZŒ±Œ≤Œ≥Œ¥ŒµŒ∂Œ∑Œ∏';
      
      for(let i = 0; i < columns; i++){
        drops.push({
          x: i * 25,
          y: Math.random() * canvas.height,
          speed: Math.random() * 2 + 1,
          chars: chars,
          trail: [],
          opacity: Math.random() * 0.8 + 0.2
        });
      }
    }
    
    function drawCodeRain(){
      if (memoryManager.isCleanedUp) {
        if (codeRainAnimationId) {
          cancelAnimationFrame(codeRainAnimationId);
          codeRainAnimationId = null;
        }
        return;
      }
      
      ctx.fillStyle = 'rgba(6, 78, 59, 0.15)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.font = '16px monospace';
      
      for(const drop of drops){
        // Add new character to trail occasionally
        if(Math.random() > 0.92){
          drop.trail.unshift({
            char: drop.chars[Math.floor(Math.random() * drop.chars.length)],
            y: drop.y,
            age: 0
          });
        }
        
        // Draw trail with fade effect
        drop.trail.forEach((char, index) => {
          const alpha = Math.max(0, (1 - (index * 0.08)) * drop.opacity);
          const green = Math.floor(185 - (index * 8));
          ctx.fillStyle = `rgba(${Math.max(16, green-50)}, ${green}, ${Math.max(129, green)}, ${alpha})`;
          ctx.fillText(char.char, drop.x, char.y);
          char.age++;
        });
        
        // Update positions
        drop.y += drop.speed;
        drop.trail = drop.trail.map(char => ({...char, y: char.y + drop.speed}));
        
        // Remove old characters
        drop.trail = drop.trail.filter((char, index) => 
          char.y < canvas.height + 30 && index < 20
        );
        
        // Reset when off screen
        if(drop.y > canvas.height + 100){
          drop.y = -30;
          drop.trail = [];
          drop.opacity = Math.random() * 0.8 + 0.2;
        }
      }
      
      codeRainAnimationId = memoryManager.addAnimationFrame(requestAnimationFrame(drawCodeRain));
    }
    
    memoryManager.addEventListener(window, 'resize', resizeCanvas); 
    resizeCanvas();
    
    if(!matchMedia('(prefers-reduced-motion: reduce)').matches && !memoryManager.isCleanedUp) {
      drawCodeRain();
    }
    
    // Celebration effect on load with cleanup
    const celebrationTimeout = memoryManager.addTimeout(
      setTimeout(() => {
        if (memoryManager.isCleanedUp) return;
        
        console.log('üéâ Discovery Chamber Accessed!');
        console.log('üéØ Master Detective Status: CONFIRMED');
        
        // Add a subtle screen flash effect
        const flash = document.createElement('div');
        flash.setAttribute('data-temp-element', 'true'); // Mark for cleanup
        flash.style.cssText = `
          position: fixed; inset: 0; background: rgba(16, 185, 129, 0.1);
          pointer-events: none; z-index: 10000; opacity: 0;
          transition: opacity 0.3s ease-out;
        `;
        document.body.appendChild(flash);
        
        const flashInTimeout = memoryManager.addTimeout(
          setTimeout(() => {
            if (!memoryManager.isCleanedUp && flash.parentNode) {
              flash.style.opacity = '1';
            }
          }, 50)
        );
        
        const flashOutTimeout = memoryManager.addTimeout(
          setTimeout(() => {
            if (!memoryManager.isCleanedUp && flash.parentNode) {
              flash.style.opacity = '0';
            }
          }, 400)
        );
        
        const removeFlashTimeout = memoryManager.addTimeout(
          setTimeout(() => {
            if (flash.parentNode) {
              document.body.removeChild(flash);
            }
          }, 700)
        );
      }, 800)
    );
    
    console.log('üöÄ Discovery chamber initialized with 10-second auto-cleanup');
  </script>
</body>
</html>
