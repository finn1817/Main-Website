<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Betting Hub - Heads-Up Poker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }

        /* Poker Table Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 80px 80px, 40px 40px;
            z-index: -1;
            opacity: 0.4;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.5);
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4aa;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .balance {
            background: linear-gradient(45deg, #00d4aa, #00b894);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .admin-badge {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
            display: none;
            animation: pulse 2s infinite;
        }

        .admin-badge.show {
            display: inline-block;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 53, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0); }
        }

        .back-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        /* Game Container */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Game Status */
        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #00d4aa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .status-value {
            font-size: 2em;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }

        .status-label {
            color: #ccc;
            font-size: 0.9em;
        }

        /* Poker Table */
        .poker-table {
            background: radial-gradient(ellipse at center, #0e4b3d 0%, #0a3529 70%);
            border-radius: 50%;
            padding: 40px;
            margin: 30px auto;
            border: 8px solid #00d4aa;
            position: relative;
            max-width: 800px;
            aspect-ratio: 1.6/1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }

        /* Player Areas */
        .opponent-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #00d4aa;
        }

        .player-chips {
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            color: #00d4aa;
        }

        .player-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-waiting {
            background: #ffc107;
            color: #000;
        }

        .status-active {
            background: #28a745;
            color: white;
        }

        .status-folded {
            background: #dc3545;
            color: white;
        }

        .status-check {
            background: #6c757d;
            color: white;
        }

        .status-call {
            background: #17a2b8;
            color: white;
        }

        .status-raise {
            background: #007bff;
            color: white;
        }

        .status-all-in {
            background: #ff6b35;
            color: white;
        }

        /* Cards */
        .hand-cards {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .card {
            width: 60px;
            height: 84px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid #ddd;
        }

        .card.dealing {
            animation: dealCard 0.5s ease-out;
        }

        .card.winning {
            animation: winPulse 1s ease-in-out infinite;
            border-color: #00d4aa;
            box-shadow: 0 0 15px rgba(0, 212, 170, 0.7);
        }

        @keyframes dealCard {
            from {
                transform: translateY(-100px) rotateY(180deg);
                opacity: 0;
            }
            to {
                transform: translateY(0) rotateY(0deg);
                opacity: 1;
            }
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .card-back {
            background: linear-gradient(45deg, #2d1b69, #11998e);
            color: #00d4aa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .card-top {
            font-size: 0.8em;
            font-weight: bold;
            line-height: 1;
        }

        .card-center {
            font-size: 1.5em;
            text-align: center;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-bottom {
            font-size: 0.8em;
            font-weight: bold;
            transform: rotate(180deg);
            text-align: right;
            line-height: 1;
        }

        .red {
            color: #dc3545;
        }

        .black {
            color: #000;
        }

        /* Community Cards */
        .community-area {
            text-align: center;
            margin: 20px 0;
        }

        .community-title {
            color: #00d4aa;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .community-cards {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .pot-info {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
        }

        .pot-amount {
            font-size: 1.4em;
            font-weight: bold;
            color: #00d4aa;
        }

        /* Game Controls */
        .game-controls {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 2px solid #00d4aa;
        }

        .controls-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #00d4aa;
            text-align: center;
        }

        .betting-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .bet-input-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .bet-input {
            padding: 10px 15px;
            border: 2px solid #00d4aa;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            width: 120px;
        }

        .bet-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
        }

        .bet-size-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .bet-size-btn {
            background: rgba(0, 212, 170, 0.2);
            color: #00d4aa;
            border: 2px solid #00d4aa;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .bet-size-btn:hover {
            background: #00d4aa;
            color: #000;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .game-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-fold {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn-call {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-raise {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }

        .btn-check {
            background: linear-gradient(45deg, #6c757d, #495057);
            color: white;
        }

        .btn-all-in {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
        }

        .game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Game Lobby */
        .game-lobby {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid #00d4aa;
        }

        .lobby-title {
            font-size: 2em;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 20px;
        }

        .lobby-description {
            color: #ccc;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .lobby-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .lobby-option {
            background: rgba(0, 212, 170, 0.1);
            border: 2px solid #00d4aa;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lobby-option:hover {
            background: rgba(0, 212, 170, 0.2);
            transform: translateY(-5px);
        }

        .option-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 10px;
        }

        .option-description {
            color: #ccc;
            margin-bottom: 15px;
        }

        .buy-in-selector {
            margin: 20px 0;
        }

        .buy-in-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .buy-in-btn {
            background: rgba(0, 0, 0, 0.6);
            color: #00d4aa;
            border: 2px solid #00d4aa;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .buy-in-btn:hover, .buy-in-btn.selected {
            background: #00d4aa;
            color: #000;
        }

        /* New Lobby Sections */
        .game-creation-section, .available-games-section, .join-by-id-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .section-title {
            font-size: 1.2em;
            color: #00d4aa;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .game-id-display {
            background: rgba(0, 212, 170, 0.1);
            border: 2px solid #00d4aa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
        }

        .game-id-title {
            color: #00d4aa;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .game-id-code {
            font-size: 2em;
            font-weight: bold;
            color: #fff;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            margin: 10px 0;
            letter-spacing: 2px;
        }

        .game-id-subtitle {
            color: #ccc;
            margin-bottom: 10px;
        }

        .game-waiting-message {
            color: #ffaa00;
            font-style: italic;
        }

        .available-games-list {
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }

        .available-game-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-info {
            flex: 1;
        }

        .game-creator {
            color: #00d4aa;
            font-weight: bold;
        }

        .game-buyin {
            color: #ffaa00;
            margin-left: 10px;
        }

        .game-time {
            color: #888;
            font-size: 0.9em;
        }

        .join-game-btn {
            background: #00d4aa;
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .join-game-btn:hover {
            background: #00ffcc;
            transform: scale(1.05);
        }

        .no-games-message {
            text-align: center;
            color: #888;
            padding: 40px;
            font-style: italic;
        }

        .refresh-games-btn {
            background: rgba(0, 212, 170, 0.2);
            color: #00d4aa;
            border: 2px solid #00d4aa;
            border-radius: 10px;
            padding: 10px 20px;
            text-align: center;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .refresh-games-btn:hover {
            background: rgba(0, 212, 170, 0.3);
        }

        .join-id-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #gameIdInput {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #333;
            border-radius: 8px;
            padding: 12px 15px;
            color: #fff;
            font-size: 1.1em;
            text-transform: uppercase;
        }

        #gameIdInput:focus {
            border-color: #00d4aa;
            outline: none;
        }

        .join-id-btn {
            background: #00d4aa;
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .join-id-btn:hover {
            background: #00ffcc;
            transform: scale(1.05);
        }

        /* Game Messages */
        .game-message {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00d4aa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .win-message {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .lose-message {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        /* Hand Evaluation Display */
        .hand-evaluation {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00d4aa;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .hand-rank {
            color: #00d4aa;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .hand-cards-used {
            color: #ccc;
            font-size: 0.9em;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .notification.warning {
            background: #ff9800;
        }

        /* Loading Animation */
        .loading {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00d4aa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .game-container {
                padding: 20px 10px;
            }
            
            .poker-table {
                padding: 20px;
                margin: 20px auto;
            }
            
            .card {
                width: 50px;
                height: 70px;
            }
            
            .betting-controls {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .game-btn {
                width: 100%;
                margin: 5px 0;
            }

            .chat-spectator-panel {
                flex-direction: column;
            }
        }

        /* Spectator System */
        .spectator-panel {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 2px solid #00d4aa;
        }

        .spectator-title {
            color: #00d4aa;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .spectator-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .spectator-item {
            background: rgba(0, 212, 170, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 0.9em;
            font-weight: bold;
        }

        .spectator-count {
            background: #00d4aa;
            color: #000;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        /* Hand History */
        .hand-history-panel {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 2px solid #00d4aa;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-title {
            color: #00d4aa;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .history-item {
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid #00d4aa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(0, 212, 170, 0.2);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-players {
            font-weight: bold;
            color: #00d4aa;
        }

        .history-result {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .result-win {
            background: #28a745;
            color: white;
        }

        .result-loss {
            background: #dc3545;
            color: white;
        }

        .history-details {
            color: #ccc;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .history-date {
            color: #888;
            font-size: 0.8em;
            margin-top: 8px;
        }

        /* Chat System */
        .chat-panel {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 2px solid #00d4aa;
            flex: 1;
        }

        .chat-title {
            color: #00d4aa;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .chat-messages {
            height: 250px;
            overflow-y: auto;
            background: rgba(0, 212, 170, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .chat-message {
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
        }

        .chat-message.system-message {
            background: rgba(0, 212, 170, 0.2);
            border-left: 3px solid #00d4aa;
            font-style: italic;
        }

        .chat-user {
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 2px;
        }

        .chat-username {
            font-weight: bold;
            color: #00d4aa;
        }

        .chat-text {
            color: #fff;
            line-height: 1.3;
            margin-left: 5px;
        }

        .chat-text.system-text {
            color: #00d4aa;
            margin-left: 0;
        }

        .chat-time {
            font-size: 0.8em;
            color: #888;
            margin-top: 4px;
            float: right;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #00d4aa;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-input::placeholder {
            color: #888;
        }

        .chat-send {
            background: #00d4aa;
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .chat-send:hover {
            background: #00b894;
            transform: translateY(-2px);
        }

        .chat-spectator-panel {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        /* Feature Toggle Buttons */
        .feature-toggles {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .toggle-btn {
            background: rgba(0, 212, 170, 0.2);
            color: #00d4aa;
            border: 2px solid #00d4aa;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover, .toggle-btn.active {
            background: #00d4aa;
            color: #000;
        }

        .feature-panel {
            display: none;
        }

        .feature-panel.active {
            display: block;
        }

        /* Game Timer */
        .turn-timer {
            background: rgba(255, 107, 53, 0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: 10px;
            animation: timerPulse 1s ease-in-out infinite;
        }

        @keyframes timerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div id="notification" class="notification"></div>

    <!-- Header -->
    <div class="header">
        <div class="logo">üé≤ Family Poker Arena</div>
        <div class="user-info">
            <span id="userBalance" class="balance">$0</span>
            <span id="adminBadge" class="admin-badge">üëë ADMIN</span>
            <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
            <div class="back-btn" id="leaveGameBtn" onclick="returnToLobby()" style="display: none; margin-left: 15px; background: #f44336;">Leave Game</div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <!-- Game Status -->
        <div class="game-status" id="gameStatus">
            <div class="status-card">
                <div class="status-value" id="pokerWins">0</div>
                <div class="status-label">Poker Wins</div>
            </div>
            <div class="status-card">
                <div class="status-value" id="pokerLosses">0</div>
                <div class="status-label">Poker Losses</div>
            </div>
            <div class="status-card">
                <div class="status-value" id="pokerWinRate">0%</div>
                <div class="status-label">Win Rate</div>
            </div>
            <div class="status-card">
                <div class="status-value" id="pokerWinnings">$0</div>
                <div class="status-label">Total Winnings</div>
            </div>
        </div>

        <!-- Game Lobby (shown when not in game) -->
        <div class="game-lobby" id="gameLobby">
            <div class="lobby-title">üé≤ Heads-Up Poker Arena</div>
            <div class="lobby-description">
                Challenge family members to intense 1v1 Texas Hold'em battles!<br>
                Choose your stakes and prepare for the ultimate poker showdown! üî•
            </div>
            
            <div class="buy-in-selector">
                <div style="color: #00d4aa; font-weight: bold; margin-bottom: 15px;">Select Buy-In Amount:</div>
                <div class="buy-in-buttons">
                    <div class="buy-in-btn" data-amount="100">$100</div>
                    <div class="buy-in-btn" data-amount="250">$250</div>
                    <div class="buy-in-btn selected" data-amount="500">$500</div>
                    <div class="buy-in-btn" data-amount="1000">$1,000</div>
                    <div class="buy-in-btn" data-amount="2500">$2,500</div>
                </div>
            </div>

            <!-- Game Creation Section -->
            <div class="game-creation-section">
                <div class="lobby-option" onclick="createGame()">
                    <div class="option-title">üöÄ Create New Game</div>
                    <div class="option-description">
                        Start a new poker game and get a Game ID to share with family.
                    </div>
                </div>
                
                <!-- Game ID Display (shown after creating) -->
                <div class="game-id-display" id="gameIdDisplay" style="display: none;">
                    <div class="game-id-title">üéØ Your Game ID:</div>
                    <div class="game-id-code" id="gameIdCode">ABCD1234</div>
                    <div class="game-id-subtitle">Share this ID with family to join your game!</div>
                    <div class="game-waiting-message">Waiting for opponent to join...</div>
                </div>
            </div>

            <!-- Available Games Section -->
            <div class="available-games-section">
                <div class="section-title">üéÆ Available Games</div>
                <div class="available-games-list" id="availableGamesList">
                    <div class="no-games-message">No games available. Create one or refresh!</div>
                </div>
                <div class="refresh-games-btn" onclick="loadAvailableGames()">üîÑ Refresh Games</div>
            </div>

            <!-- Join by Game ID Section -->
            <div class="join-by-id-section">
                <div class="section-title">üîó Join by Game ID</div>
                <div class="join-id-input-group">
                    <input type="text" id="gameIdInput" placeholder="Enter Game ID (e.g., ABCD1234)" maxlength="8">
                    <div class="join-id-btn" onclick="joinGameById()">Join Game</div>
                </div>
            </div>
        </div>

        <!-- Poker Table (hidden initially) -->
        <div class="poker-table" id="pokerTable" style="display: none;">
            <!-- Opponent Area -->
            <div class="opponent-area">
                <div class="player-info">
                    <div class="player-name" id="opponentName">Waiting for opponent...</div>
                    <div class="player-chips" id="opponentChips">$0</div>
                    <div class="player-status" id="opponentStatus">Waiting</div>
                    <div id="opponentTimer" class="turn-timer" style="display: none;">30s</div>
                </div>
                <div class="hand-cards" id="opponentHand">
                    <!-- Opponent cards will be added here -->
                </div>
            </div>

            <!-- Community Cards Area -->
            <div class="community-area">
                <div class="community-title">Community Cards</div>
                <div class="community-cards" id="communityCards">
                    <!-- Community cards will be added here -->
                </div>
                <div class="pot-info">
                    <div class="pot-amount" id="potAmount">$0</div>
                    <div style="color: #ccc; font-size: 0.9em;">Total Pot</div>
                </div>
            </div>

            <!-- Player Area -->
            <div class="player-area">
                <div class="hand-cards" id="playerHand">
                    <!-- Player cards will be added here -->
                </div>
                <div class="player-info">
                    <div class="player-name" id="playerName">You</div>
                    <div class="player-chips" id="playerChips">$0</div>
                    <div class="player-status" id="playerStatus">Active</div>
                    <div id="playerTimer" class="turn-timer" style="display: none;">30s</div>
                </div>
            </div>
        </div>

        <!-- Hand Evaluation Display -->
        <div class="hand-evaluation" id="handEvaluation" style="display: none;">
            <div class="hand-rank" id="handRank">High Card</div>
            <div class="hand-cards-used" id="handCardsUsed">Using: A‚ô† K‚ô•</div>
        </div>

        <!-- Game Message -->
        <div class="game-message" id="gameMessage" style="display: none;">
            Welcome to Family Poker Arena! üé≤
        </div>

        <!-- Game Controls -->
        <div class="game-controls" id="gameControls" style="display: none;">
            <div class="controls-title">Your Turn</div>
            
            <div class="bet-input-container">
                <label for="betAmount" style="color: #00d4aa; font-weight: bold;">Bet Amount:</label>
                <input type="number" id="betAmount" class="bet-input" min="0" value="50" placeholder="Amount">
            </div>

            <div class="bet-size-buttons">
                <div class="bet-size-btn" onclick="setBetSize('min')">Min Bet</div>
                <div class="bet-size-btn" onclick="setBetSize('half')">1/2 Pot</div>
                <div class="bet-size-btn" onclick="setBetSize('full')">Full Pot</div>
                <div class="bet-size-btn" onclick="setBetSize('max')">All In</div>
            </div>

            <div class="action-buttons">
                <button class="game-btn btn-fold" onclick="foldHand()">Fold</button>
                <button class="game-btn btn-check" onclick="checkHand()" id="checkBtn">Check</button>
                <button class="game-btn btn-call" onclick="callBet()" id="callBtn">Call</button>
                <button class="game-btn btn-raise" onclick="raiseBet()">Raise</button>
                <button class="game-btn btn-all-in" onclick="allIn()">All In</button>
            </div>
        </div>

        <!-- Feature Toggle Buttons -->
        <div class="feature-toggles">
            <button class="toggle-btn" onclick="toggleFeature('spectators')">üë• Spectators</button>
            <button class="toggle-btn active" onclick="toggleFeature('chat')">üí¨ Chat</button>
            <button class="toggle-btn" onclick="toggleFeature('history')">üìñ Hand History</button>
        </div>

        <!-- Chat & Spectator Panel -->
        <div class="chat-spectator-panel">
            <!-- Chat System -->
            <div class="chat-panel feature-panel active" id="chatPanel">
                <div class="chat-title">üí¨ Game Chat & Trash Talk</div>
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message">
                        <div class="chat-user">System</div>
                        <div class="chat-text">Welcome to the poker arena! Let the trash talk begin! üé≤</div>
                        <div class="chat-time">Just now</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Type your message... üí¨" maxlength="200">
                    <button class="chat-send" onclick="sendChatMessage()">Send</button>
                </div>
            </div>

            <!-- Spectator System -->
            <div class="spectator-panel feature-panel" id="spectatorPanel">
                <div class="spectator-title">üë• Live Spectators <span class="spectator-count" id="spectatorCount">0</span></div>
                <div class="spectator-list" id="spectatorList">
                    <div class="spectator-item">No spectators yet</div>
                </div>
                <div style="text-align: center; margin-top: 15px; color: #888; font-size: 0.9em;">
                    Family members can watch this epic battle live! üçø
                </div>
            </div>
        </div>

        <!-- Hand History -->
        <div class="hand-history-panel feature-panel" id="historyPanel">
            <div class="history-title">üìñ Hand History</div>
            <div id="handHistoryList">
                <div style="text-align: center; color: #888; padding: 40px;">
                    No hands played yet. Start your first game to see history! üé≤
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loading"></div>

    <!-- Firebase Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            orderBy,
            or,
            doc, 
            setDoc, 
            updateDoc, 
            getDoc,
            deleteDoc,
            onSnapshot,
            arrayUnion,
            arrayRemove,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBs0mLN4_HzWx9nGdOjCsewT3X6F69Ysik",
            authDomain: "family-bets-1967f.firebaseapp.com",
            projectId: "family-bets-1967f",
            storageBucket: "family-bets-1967f.firebasestorage.app",
            messagingSenderId: "13304744240",
            appId: "1:13304744240:web:1e9a2c0ddb1703474b60f5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.db = db;
        window.firestoreUtils = { 
            collection, addDoc, getDocs, query, where, orderBy, or, doc, setDoc, updateDoc, getDoc, deleteDoc, onSnapshot, arrayUnion, arrayRemove, serverTimestamp
        };

        // Initialize poker
        initializePoker();
    </script>

    <script>
        // Global variables
        let currentUser = null;
        let currentGame = null;
        let gameListener = null;
        let selectedBuyIn = 500;
        let turnTimer = null;
        let turnTimeLeft = 30;
        
        let pokerStats = {
            wins: 0,
            losses: 0,
            winnings: 0
        };

        // Feature tracking
        let activeFeature = 'chat';
        let spectators = [];
        let handHistory = [];

        // Poker game state
        let gameState = {
            gameId: null,
            phase: 'waiting', // waiting, preflop, flop, turn, river, showdown
            pot: 0,
            playerChips: 0,
            opponentChips: 0,
            playerCards: [],
            opponentCards: [],
            communityCards: [],
            currentBet: 0,
            playerBet: 0,
            opponentBet: 0,
            lastAction: null,
            turn: null, // 'creator' or 'opponent'
            smallBlind: 25,
            bigBlind: 50,
            dealer: 'creator', // Alternates each hand
            isCreator: false
        };

        // Poker hand rankings
        const handRankings = {
            'high-card': 1,
            'pair': 2,
            'two-pair': 3,
            'three-of-a-kind': 4,
            'straight': 5,
            'flush': 6,
            'full-house': 7,
            'four-of-a-kind': 8,
            'straight-flush': 9,
            'royal-flush': 10
        };

        // Feature toggle functions
        function toggleFeature(feature) {
            activeFeature = feature;
            
            // Hide all panels
            document.getElementById('chatPanel').style.display = 'none';
            document.getElementById('spectatorPanel').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            
            // Remove active class from all buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected panel and mark button as active
            if (feature === 'chat') {
                document.getElementById('chatPanel').style.display = 'block';
                document.querySelector('[onclick="toggleFeature(\'chat\')"]').classList.add('active');
            } else if (feature === 'spectators') {
                document.getElementById('spectatorPanel').style.display = 'block';
                document.querySelector('[onclick="toggleFeature(\'spectators\')"]').classList.add('active');
            } else if (feature === 'history') {
                document.getElementById('historyPanel').style.display = 'block';
                document.querySelector('[onclick="toggleFeature(\'history\')"]').classList.add('active');
            }
        }

        // Chat functions
        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (message === '' || !currentGame) return;
            
            try {
                const { doc, updateDoc, arrayUnion } = window.firestoreUtils;
                
                // Add chat message to game document
                const gameDoc = doc(window.db, 'games', currentGame);
                updateDoc(gameDoc, {
                    chat: arrayUnion({
                        username: currentUser.username,
                        message: message,
                        timestamp: new Date().toISOString(),
                        type: 'user'
                    }),
                    lastActivity: new Date().toISOString()
                }).then(() => {
                    chatInput.value = '';
                }).catch(error => {
                    console.error('Error sending chat message:', error);
                });
            } catch (error) {
                console.error('Error in sendChatMessage:', error);
            }
        }

        function addChatMessage(username, message, timestamp) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = username === 'System' ? 'chat-message system-message' : 'chat-message';
            
            // Handle both ISO string timestamps and Date objects
            const time = typeof timestamp === 'string' ? 
                new Date(timestamp).toLocaleTimeString() : 
                (timestamp.toDate ? timestamp.toDate().toLocaleTimeString() : new Date(timestamp).toLocaleTimeString());
            
            if (username === 'System') {
                messageDiv.innerHTML = `
                    <span class="chat-text system-text">${message}</span>
                    <span class="chat-time">${time}</span>
                `;
            } else {
                messageDiv.innerHTML = `
                    <span class="chat-username">${username}:</span>
                    <span class="chat-text">${message}</span>
                    <span class="chat-time">${time}</span>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Timer functions
        function startTurnTimer(isPlayerTurn) {
            clearInterval(turnTimer);
            turnTimeLeft = 30;
            
            const playerTimerDiv = document.getElementById('playerTimer');
            const opponentTimerDiv = document.getElementById('opponentTimer');
            
            // Hide both timers first
            playerTimerDiv.style.display = 'none';
            opponentTimerDiv.style.display = 'none';
            
            if (isPlayerTurn) {
                playerTimerDiv.style.display = 'inline-block';
                turnTimer = setInterval(() => {
                    turnTimeLeft--;
                    playerTimerDiv.textContent = turnTimeLeft + 's';
                    
                    if (turnTimeLeft <= 0) {
                        clearInterval(turnTimer);
                        // Auto-fold on timeout
                        foldHand();
                    }
                }, 1000);
            } else {
                opponentTimerDiv.style.display = 'inline-block';
                turnTimer = setInterval(() => {
                    turnTimeLeft--;
                    opponentTimerDiv.textContent = turnTimeLeft + 's';
                    
                    if (turnTimeLeft <= 0) {
                        clearInterval(turnTimer);
                    }
                }, 1000);
            }
        }

        function stopTurnTimer() {
            clearInterval(turnTimer);
            document.getElementById('playerTimer').style.display = 'none';
            document.getElementById('opponentTimer').style.display = 'none';
        }

        // Initialize Poker
        async function initializePoker() {
            // Check if user is logged in
            const savedUser = localStorage.getItem('familyBettingUser');
            if (!savedUser) {
                window.location.href = 'index.html';
                return;
            }

            currentUser = JSON.parse(savedUser);
            
            // Update UI
            document.getElementById('playerName').textContent = currentUser.username;
            
            // Update user stats and balance
            await updateUserStats();
            
            // Set up buy-in selection
            setupBuyInSelection();
            
            // Initialize features
            toggleFeature('chat'); // Start with chat panel open
            loadHandHistory(); // Load user's poker history
            loadAvailableGames(); // Load available games to join
            
            // Set up chat input enter key
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            showNotification('Welcome to the Poker Arena! üé≤', 'success');
        }

        // Update user stats from database
        async function updateUserStats() {
            try {
                const { doc, getDoc } = window.firestoreUtils;
                const userDoc = await getDoc(doc(window.db, 'users', currentUser.id));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    currentUser = { ...currentUser, ...userData };
                    localStorage.setItem('familyBettingUser', JSON.stringify(currentUser));
                    
                    // Update balance
                    document.getElementById('userBalance').textContent = '$' + userData.balance.toLocaleString();
                    
                    // Update poker stats - matching database field names from image
                    pokerStats.wins = userData.blackjackWins || 0; // Using existing field structure
                    pokerStats.losses = userData.betsLost || 0;
                    pokerStats.winnings = userData.blackjackWinnings || 0;
                    
                    updateStatsDisplay();
                    
                    // Show/hide admin badge
                    const adminBadge = document.getElementById('adminBadge');
                    if (userData.isAdmin === 1) {
                        adminBadge.classList.add('show');
                    } else {
                        adminBadge.classList.remove('show');
                    }
                }
            } catch (error) {
                console.error('Error updating user stats:', error);
                showNotification('Error loading user data', 'error');
            }
        }

        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('pokerWins').textContent = pokerStats.wins;
            document.getElementById('pokerLosses').textContent = pokerStats.losses;
            document.getElementById('pokerWinnings').textContent = '$' + pokerStats.winnings.toLocaleString();
            
            const totalGames = pokerStats.wins + pokerStats.losses;
            const winRate = totalGames > 0 ? Math.round((pokerStats.wins / totalGames) * 100) : 0;
            document.getElementById('pokerWinRate').textContent = winRate + '%';
        }

        // Setup buy-in selection
        function setupBuyInSelection() {
            const buyInButtons = document.querySelectorAll('.buy-in-btn');
            buyInButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    buyInButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedBuyIn = parseInt(btn.dataset.amount);
                });
            });
        }

        // Bet sizing helpers
        function setBetSize(type) {
            const betInput = document.getElementById('betAmount');
            let amount = 0;
            
            switch(type) {
                case 'min':
                    amount = Math.max(gameState.bigBlind, gameState.currentBet + gameState.bigBlind);
                    break;
                case 'half':
                    amount = Math.floor(gameState.pot / 2);
                    break;
                case 'full':
                    amount = gameState.pot;
                    break;
                case 'max':
                    amount = gameState.playerChips;
                    break;
            }
            
            betInput.value = Math.min(amount, gameState.playerChips);
        }

        // Create new game
        async function createGame() {
            console.log('createGame called');
            
            if (!currentUser) {
                showNotification('User not logged in!', 'error');
                return;
            }
            
            if (selectedBuyIn > currentUser.balance) {
                showNotification('Insufficient funds for this buy-in!', 'error');
                return;
            }

            try {
                const { collection, addDoc } = window.firestoreUtils;
                
                if (!collection || !addDoc) {
                    throw new Error('Firebase utils not available');
                }
                
                const gameData = {
                    // Game info
                    gameType: 'poker',
                    creator: currentUser.id,
                    creatorName: currentUser.username,
                    buyIn: selectedBuyIn,
                    status: 'waiting_for_opponent',
                    createdAt: new Date().toISOString(),
                    lastActivity: new Date().toISOString(),
                    
                    // Poker specific
                    pot: 0,
                    phase: 'waiting',
                    smallBlind: Math.max(10, Math.floor(selectedBuyIn * 0.02)),
                    bigBlind: Math.max(20, Math.floor(selectedBuyIn * 0.04)),
                    dealer: 'creator',
                    turn: null,
                    deck: null,
                    
                    // Player states
                    creatorChips: selectedBuyIn,
                    opponentChips: selectedBuyIn,
                    creatorBet: 0,
                    opponentBet: 0,
                    creatorCards: [],
                    opponentCards: [],
                    communityCards: [],
                    creatorAction: null,
                    opponentAction: null,
                    
                    // Players
                    players: [currentUser.id],
                    playerNames: [currentUser.username],
                    
                    // Embedded features
                    chat: [],
                    spectators: [],
                    handHistory: []
                };
                
                const gamesRef = collection(window.db, 'games');
                const gameDoc = await addDoc(gamesRef, gameData);
                
                gameState.gameId = gameDoc.id;
                gameState.isCreator = true;
                currentGame = gameDoc.id;

                // Generate a short, shareable Game ID (first 8 characters)
                const shortGameId = gameDoc.id.substring(0, 8).toUpperCase();

                // Show the Game ID display section
                document.getElementById('gameIdDisplay').style.display = 'block';
                document.getElementById('gameIdCode').textContent = shortGameId;

                // Start listening for game updates
                startGameListener();

                showNotification(`Game created! Game ID: ${shortGameId}`, 'success');

            } catch (error) {
                console.error('Error creating game:', error);
                showNotification('Failed to create game: ' + error.message, 'error');
            }
        }

        // Load available games to join
        async function loadAvailableGames() {
            try {
                const { collection, getDocs, query, where } = window.firestoreUtils;
                
                const gamesRef = collection(window.db, 'games');
                const q = query(gamesRef, 
                    where("gameType", "==", "poker"),
                    where("status", "==", "waiting_for_opponent")
                );
                const querySnapshot = await getDocs(q);

                const gamesList = document.getElementById('availableGamesList');
                gamesList.innerHTML = '';

                if (querySnapshot.empty) {
                    gamesList.innerHTML = '<div class="no-games-message">No games available. Create one or refresh!</div>';
                    return;
                }

                querySnapshot.forEach(doc => {
                    const gameData = doc.data();
                    const gameId = doc.id.substring(0, 8).toUpperCase();
                    const timeAgo = getTimeAgo(new Date(gameData.createdAt));
                    
                    // Don't show games created by current user
                    if (gameData.creator === currentUser.id) return;

                    const gameItem = document.createElement('div');
                    gameItem.className = 'available-game-item';
                    gameItem.innerHTML = `
                        <div class="game-info">
                            <div class="game-creator">${gameData.creatorName}</div>
                            <span class="game-buyin">$${gameData.buyIn}</span>
                            <div class="game-time">${timeAgo}</div>
                        </div>
                        <button class="join-game-btn" onclick="joinSpecificGame('${doc.id}')">
                            Join Game
                        </button>
                    `;
                    gamesList.appendChild(gameItem);
                });

            } catch (error) {
                console.error('Error loading available games:', error);
                showNotification('Failed to load available games', 'error');
            }
        }

        // Join a specific game by full ID
        async function joinSpecificGame(gameId) {
            try {
                const { doc, getDoc, updateDoc, arrayUnion } = window.firestoreUtils;
                
                const gameDoc = await getDoc(doc(window.db, 'games', gameId));
                if (!gameDoc.exists()) {
                    showNotification('Game not found!', 'error');
                    return;
                }

                const gameData = gameDoc.data();

                if (gameData.status !== 'waiting_for_opponent') {
                    showNotification('This game is no longer available!', 'warning');
                    loadAvailableGames(); // Refresh the list
                    return;
                }

                if (gameData.creator === currentUser.id) {
                    showNotification('You cannot join your own game!', 'warning');
                    return;
                }

                if (gameData.buyIn > currentUser.balance) {
                    showNotification('Insufficient funds for this buy-in!', 'error');
                    return;
                }

                // Update buy-in to match the game
                selectedBuyIn = gameData.buyIn;
                updateBuyInSelection(selectedBuyIn);

                // Update game with opponent and add to players array
                await updateDoc(doc(window.db, 'games', gameId), {
                    opponent: currentUser.id,
                    opponentName: currentUser.username,
                    status: 'active',
                    lastActivity: new Date().toISOString(),
                    players: arrayUnion(currentUser.id),
                    playerNames: arrayUnion(currentUser.username),
                    opponentChips: selectedBuyIn
                });

                gameState.gameId = gameId;
                gameState.isCreator = false;
                currentGame = gameId;

                // Hide lobby and start game
                document.getElementById('gameLobby').style.display = 'none';
                document.getElementById('pokerTable').style.display = 'flex';
                document.getElementById('gameMessage').style.display = 'block';
                document.getElementById('gameMessage').textContent = 'Game joined! Dealing cards... üÉè';

                // Start listening for game updates
                startGameListener();

                showNotification(`Joined ${gameData.creatorName}'s game!`, 'success');

            } catch (error) {
                console.error('Error joining specific game:', error);
                showNotification('Failed to join game', 'error');
            }
        }

        // Join game by Game ID
        async function joinGameById() {
            const gameIdInput = document.getElementById('gameIdInput');
            const shortGameId = gameIdInput.value.trim().toUpperCase();

            if (!shortGameId) {
                showNotification('Please enter a Game ID!', 'warning');
                return;
            }

            if (shortGameId.length !== 8) {
                showNotification('Game ID should be 8 characters!', 'warning');
                return;
            }

            try {
                const { collection, getDocs, query, where } = window.firestoreUtils;
                
                // Find game with matching ID start
                const gamesRef = collection(window.db, 'games');
                const q = query(gamesRef, where("gameType", "==", "poker"));
                const querySnapshot = await getDocs(q);

                let foundGame = null;
                querySnapshot.forEach(doc => {
                    if (doc.id.substring(0, 8).toUpperCase() === shortGameId) {
                        foundGame = { id: doc.id, data: doc.data() };
                    }
                });

                if (!foundGame) {
                    showNotification('Game ID not found!', 'error');
                    return;
                }

                if (foundGame.data.status !== 'waiting_for_opponent') {
                    showNotification('This game is no longer available!', 'warning');
                    return;
                }

                if (foundGame.data.creator === currentUser.id) {
                    showNotification('You cannot join your own game!', 'warning');
                    return;
                }

                // Join the found game
                await joinSpecificGame(foundGame.id);
                
                // Clear the input
                gameIdInput.value = '';

            } catch (error) {
                console.error('Error joining game by ID:', error);
                showNotification('Failed to join game', 'error');
            }
        }

        // Helper function to get time ago
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours}h ago`;
            
            const diffDays = Math.floor(diffHours / 24);
            return `${diffDays}d ago`;
        }

        // Update buy-in selection to match a specific amount
        function updateBuyInSelection(amount) {
            // Remove selected class from all buttons
            document.querySelectorAll('.buy-in-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to matching button
            const matchingBtn = document.querySelector(`.buy-in-btn[data-amount="${amount}"]`);
            if (matchingBtn) {
                matchingBtn.classList.add('selected');
            }
            
            selectedBuyIn = amount;
        }

        // Start game listener
        function startGameListener() {
            if (gameListener) gameListener();

            const { doc, onSnapshot } = window.firestoreUtils;
            const gameDoc = doc(window.db, 'games', gameState.gameId);

            gameListener = onSnapshot(gameDoc, (snapshot) => {
                if (snapshot.exists()) {
                    const gameData = snapshot.data();
                    updateGameState(gameData);
                } else {
                    // Game was deleted, return to lobby
                    showNotification('Game ended or was removed', 'warning');
                    returnToLobby();
                }
            });
        }

        // Update game state from Firebase
        function updateGameState(gameData) {
            currentGame = gameData;
            
            // Update chat messages from embedded chat array
            if (gameData.chat && gameData.chat.length > 0) {
                const chatMessages = document.getElementById('chatMessages');
                const currentMessageCount = chatMessages.children.length - 1; // Subtract welcome message
                
                // Only add new messages (compare lengths)
                if (gameData.chat.length > currentMessageCount) {
                    for (let i = currentMessageCount; i < gameData.chat.length; i++) {
                        const msg = gameData.chat[i];
                        addChatMessage(msg.username, msg.message, msg.timestamp);
                    }
                }
            }
            
            // Update spectators from embedded spectators array
            if (gameData.spectators) {
                spectators = gameData.spectators;
                updateSpectatorList();
            }
            
            // Update UI based on game status
            if (gameData.status === 'active' && gameData.opponent) {
                // Show poker table and leave button
                document.getElementById('pokerTable').style.display = 'flex';
                document.getElementById('gameMessage').style.display = 'block';
                document.getElementById('leaveGameBtn').style.display = 'inline-block';
                
                // Update player info
                const isCreator = gameState.isCreator;
                const opponentName = isCreator ? gameData.opponentName : gameData.creatorName;
                const playerChips = isCreator ? gameData.creatorChips : gameData.opponentChips;
                const opponentChips = isCreator ? gameData.opponentChips : gameData.creatorChips;
                
                document.getElementById('opponentName').textContent = opponentName;
                document.getElementById('playerChips').textContent = '$' + playerChips;
                document.getElementById('opponentChips').textContent = '$' + opponentChips;
                
                // Update game state
                gameState.playerChips = playerChips;
                gameState.opponentChips = opponentChips;
                gameState.pot = gameData.pot;
                gameState.phase = gameData.phase;
                gameState.turn = gameData.turn;
                gameState.currentBet = Math.max(gameData.creatorBet || 0, gameData.opponentBet || 0);
                
                // Update pot display
                document.getElementById('potAmount').textContent = '$' + gameData.pot;
                
                // Update cards if they exist
                if (gameData.communityCards) {
                    updateCommunityCards(gameData.communityCards);
                }
                
                if (isCreator && gameData.creatorCards) {
                    updatePlayerCards(gameData.creatorCards);
                } else if (!isCreator && gameData.opponentCards) {
                    updatePlayerCards(gameData.opponentCards);
                }
                
                // Update opponent cards (hidden)
                updateOpponentCards(2); // Always 2 cards in Texas Hold'em
                
                // Update player status displays
                updatePlayerStatuses(gameData);
                
                // Handle turn management
                const isPlayerTurn = (isCreator && gameData.turn === 'creator') || (!isCreator && gameData.turn === 'opponent');
                
                if (isPlayerTurn && gameData.phase !== 'waiting' && gameData.phase !== 'showdown') {
                    document.getElementById('gameControls').style.display = 'block';
                    startTurnTimer(true);
                    updateActionButtons(gameData);
                } else {
                    document.getElementById('gameControls').style.display = 'none';
                    stopTurnTimer();
                    if (!isPlayerTurn && gameData.phase !== 'waiting' && gameData.phase !== 'showdown') {
                        startTurnTimer(false);
                    }
                }
                
                // Send welcome message when game becomes active
                if (gameData.phase === 'waiting' && gameData.opponent && gameData.chat.length === 0) {
                    addSystemMessage(`${currentUser.username} and ${opponentName} joined the game! Good luck! üé≤`);
                    
                    // Auto-start the game after a delay
                    setTimeout(() => {
                        if (gameState.isCreator) {
                            dealNewHand();
                        }
                    }, 2000);
                }
                
                // Handle showdown phase
                if (gameData.phase === 'showdown') {
                    handleShowdown(gameData);
                }
            }
        }

        // Update player status displays
        function updatePlayerStatuses(gameData) {
            const isCreator = gameState.isCreator;
            const playerAction = isCreator ? gameData.creatorAction : gameData.opponentAction;
            const opponentAction = isCreator ? gameData.opponentAction : gameData.creatorAction;
            
            // Update player status
            const playerStatus = document.getElementById('playerStatus');
            if (playerAction) {
                playerStatus.textContent = capitalizeFirst(playerAction);
                playerStatus.className = 'player-status status-' + playerAction;
            } else {
                playerStatus.textContent = 'Active';
                playerStatus.className = 'player-status status-active';
            }
            
            // Update opponent status
            const opponentStatus = document.getElementById('opponentStatus');
            if (opponentAction) {
                opponentStatus.textContent = capitalizeFirst(opponentAction);
                opponentStatus.className = 'player-status status-' + opponentAction;
            } else {
                opponentStatus.textContent = 'Active';
                opponentStatus.className = 'player-status status-active';
            }
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Update action buttons based on game state
        function updateActionButtons(gameData) {
            const isCreator = gameState.isCreator;
            const playerBet = isCreator ? gameData.creatorBet || 0 : gameData.opponentBet || 0;
            const opponentBet = isCreator ? gameData.opponentBet || 0 : gameData.creatorBet || 0;
            const callAmount = opponentBet - playerBet;
            
            const checkBtn = document.getElementById('checkBtn');
            const callBtn = document.getElementById('callBtn');
            
            if (callAmount > 0) {
                checkBtn.style.display = 'none';
                callBtn.style.display = 'inline-block';
                callBtn.textContent = `Call $${callAmount}`;
            } else {
                checkBtn.style.display = 'inline-block';
                callBtn.style.display = 'none';
            }
            
            // Update bet input with minimum raise
            const betInput = document.getElementById('betAmount');
            const minRaise = Math.max(gameData.bigBlind, callAmount + gameData.bigBlind);
            betInput.min = minRaise;
            betInput.value = minRaise;
        }

        // Deal new hand
        async function dealNewHand() {
            if (!gameState.isCreator) return; // Only creator can deal
            
            try {
                const deck = createDeck();
                shuffleDeck(deck);

                // Deal 2 cards to each player
                const creatorCards = [deck.pop(), deck.pop()];
                const opponentCards = [deck.pop(), deck.pop()];

                // Determine who is small blind (dealer is small blind in heads-up)
                const dealerIsCreator = currentGame.dealer === 'creator';
                const smallBlindPlayer = dealerIsCreator ? 'creator' : 'opponent';
                const bigBlindPlayer = dealerIsCreator ? 'opponent' : 'creator';
                
                const smallBlind = currentGame.smallBlind || 25;
                const bigBlind = currentGame.bigBlind || 50;

                // Update game state
                const { doc, updateDoc } = window.firestoreUtils;
                await updateDoc(doc(window.db, 'games', gameState.gameId), {
                    phase: 'preflop',
                    pot: smallBlind + bigBlind,
                    creatorCards: creatorCards,
                    opponentCards: opponentCards,
                    communityCards: [],
                    creatorBet: dealerIsCreator ? smallBlind : bigBlind,
                    opponentBet: dealerIsCreator ? bigBlind : smallBlind,
                    creatorChips: selectedBuyIn - (dealerIsCreator ? smallBlind : bigBlind),
                    opponentChips: selectedBuyIn - (dealerIsCreator ? bigBlind : smallBlind),
                    turn: bigBlindPlayer, // Big blind acts first preflop in heads-up
                    creatorAction: null,
                    opponentAction: null,
                    lastActivity: new Date().toISOString()
                });

                addSystemMessage('Cards dealt! üÉè Let the battle begin!');

            } catch (error) {
                console.error('Error dealing new hand:', error);
                showNotification('Error dealing cards', 'error');
            }
        }

        // Add system message
        async function addSystemMessage(message) {
            try {
                const { doc, updateDoc, arrayUnion } = window.firestoreUtils;
                await updateDoc(doc(window.db, 'games', gameState.gameId), {
                    chat: arrayUnion({
                        username: 'System',
                        message: message,
                        timestamp: new Date().toISOString(),
                        type: 'system'
                    })
                });
            } catch (error) {
                console.error('Error adding system message:', error);
            }
        }

        // Update card displays
        function updatePlayerCards(cards) {
            const playerHandDiv = document.getElementById('playerHand');
            playerHandDiv.innerHTML = '';
            cards.forEach(card => {
                const cardElement = createCardElement(card);
                cardElement.classList.add('dealing');
                playerHandDiv.appendChild(cardElement);
            });
        }

        function updateOpponentCards(count) {
            const opponentHandDiv = document.getElementById('opponentHand');
            opponentHandDiv.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const cardElement = createCardElement(null, true);
                cardElement.classList.add('dealing');
                opponentHandDiv.appendChild(cardElement);
            }
        }

        function updateCommunityCards(cards) {
            const communityDiv = document.getElementById('communityCards');
            const currentCards = communityDiv.children.length;
            
            // Only add new cards
            for (let i = currentCards; i < cards.length; i++) {
                const cardElement = createCardElement(cards[i]);
                cardElement.classList.add('dealing');
                communityDiv.appendChild(cardElement);
            }
        }

        // Create deck of cards
        function createDeck() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const deck = [];

            suits.forEach(suit => {
                ranks.forEach(rank => {
                    deck.push({ rank, suit });
                });
            });

            return deck;
        }

        // Shuffle deck
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // Create card element
        function createCardElement(card, isHidden = false) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';

            if (isHidden || !card) {
                cardDiv.innerHTML = '<div class="card-back">üé≤</div>';
            } else {
                const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
                const colorClass = isRed ? 'red' : 'black';
                
                cardDiv.innerHTML = `
                    <div class="card-top ${colorClass}">${card.rank}${card.suit}</div>
                    <div class="card-center ${colorClass}">${card.suit}</div>
                    <div class="card-bottom ${colorClass}">${card.rank}${card.suit}</div>
                `;
            }

            return cardDiv;
        }

        // Poker actions
        async function foldHand() {
            await makeAction('fold', 0);
            showNotification('You folded', 'warning');
        }

        async function checkHand() {
            await makeAction('check', 0);
            showNotification('You checked', 'success');
        }

        async function callBet() {
            const isCreator = gameState.isCreator;
            const gameData = currentGame;
            const playerBet = isCreator ? gameData.creatorBet || 0 : gameData.opponentBet || 0;
            const opponentBet = isCreator ? gameData.opponentBet || 0 : gameData.creatorBet || 0;
            const callAmount = opponentBet - playerBet;
            
            if (callAmount > gameState.playerChips) {
                showNotification('Not enough chips to call!', 'error');
                return;
            }
            
            await makeAction('call', callAmount);
            showNotification(`You called $${callAmount}`, 'success');
        }

        async function raiseBet() {
            const raiseAmount = parseInt(document.getElementById('betAmount').value);
            const isCreator = gameState.isCreator;
            const gameData = currentGame;
            const playerBet = isCreator ? gameData.creatorBet || 0 : gameData.opponentBet || 0;
            const opponentBet = isCreator ? gameData.opponentBet || 0 : gameData.creatorBet || 0;
            const callAmount = opponentBet - playerBet;
            const totalBet = callAmount + raiseAmount;
            
            if (totalBet > gameState.playerChips) {
                showNotification('Not enough chips to raise that amount!', 'error');
                return;
            }
            
            if (raiseAmount < gameData.bigBlind) {
                showNotification(`Minimum raise is $${gameData.bigBlind}`, 'error');
                return;
            }
            
            await makeAction('raise', totalBet);
            showNotification(`You raised $${raiseAmount}`, 'success');
        }

        async function allIn() {
            await makeAction('all-in', gameState.playerChips);
            showNotification('You went ALL IN! üî•', 'warning');
        }

        // Make poker action
        async function makeAction(action, amount) {
            try {
                const { doc, updateDoc } = window.firestoreUtils;
                const isCreator = gameState.isCreator;
                const gameData = currentGame;
                
                // Calculate new values
                const currentPlayerBet = isCreator ? gameData.creatorBet || 0 : gameData.opponentBet || 0;
                const newPlayerBet = currentPlayerBet + amount;
                const newPlayerChips = gameState.playerChips - amount;
                const newPot = gameData.pot + amount;
                
                // Determine next turn
                let nextTurn = isCreator ? 'opponent' : 'creator';
                let nextPhase = gameData.phase;
                
                // Handle end of betting round
                if (action === 'fold') {
                    // Game ends, opponent wins
                    nextPhase = 'showdown';
                    nextTurn = null;
                } else if (action === 'call' || action === 'check') {
                    // Check if betting round is complete
                    const opponentBet = isCreator ? gameData.opponentBet || 0 : gameData.creatorBet || 0;
                    if (newPlayerBet === opponentBet) {
                        // Betting round complete, advance phase
                        nextPhase = getNextPhase(gameData.phase);
                        nextTurn = gameData.dealer; // Dealer acts first post-flop
                    }
                }
                
                // Update game state
                const updates = {
                    pot: newPot,
                    phase: nextPhase,
                    turn: nextTurn,
                    lastActivity: new Date().toISOString()
                };
                
                if (isCreator) {
                    updates.creatorBet = newPlayerBet;
                    updates.creatorChips = newPlayerChips;
                    updates.creatorAction = action;
                } else {
                    updates.opponentBet = newPlayerBet;
                    updates.opponentChips = newPlayerChips;
                    updates.opponentAction = action;
                }
                
                // Handle community cards for new phases
                if (nextPhase === 'flop' && gameData.phase === 'preflop') {
                    const deck = createDeck();
                    shuffleDeck(deck);
                    // Remove player cards from deck (simulate)
                    for (let i = 0; i < 4; i++) deck.pop();
                    updates.communityCards = [deck.pop(), deck.pop(), deck.pop()];
                } else if (nextPhase === 'turn' && gameData.phase === 'flop') {
                    const deck = createDeck();
                    shuffleDeck(deck);
                    for (let i = 0; i < 7; i++) deck.pop();
                    updates.communityCards = [...gameData.communityCards, deck.pop()];
                } else if (nextPhase === 'river' && gameData.phase === 'turn') {
                    const deck = createDeck();
                    shuffleDeck(deck);
                    for (let i = 0; i < 8; i++) deck.pop();
                    updates.communityCards = [...gameData.communityCards, deck.pop()];
                }
                
                await updateDoc(doc(window.db, 'games', gameState.gameId), updates);
                
            } catch (error) {
                console.error('Error making action:', error);
                showNotification('Error making action', 'error');
            }
        }

        function getNextPhase(currentPhase) {
            switch(currentPhase) {
                case 'preflop': return 'flop';
                case 'flop': return 'turn';
                case 'turn': return 'river';
                case 'river': return 'showdown';
                default: return currentPhase;
            }
        }

        // Handle showdown phase
        function handleShowdown(gameData) {
            stopTurnTimer();
            document.getElementById('gameControls').style.display = 'none';
            
            // Determine winner
            let winner = null;
            let winMessage = '';
            
            if (gameData.creatorAction === 'fold') {
                winner = 'opponent';
                winMessage = `${gameData.opponentName} wins by fold!`;
            } else if (gameData.opponentAction === 'fold') {
                winner = 'creator';
                winMessage = `${gameData.creatorName} wins by fold!`;
            } else {
                // Evaluate hands (simplified - in real poker you'd need full hand evaluation)
                winner = 'creator'; // Placeholder
                winMessage = `${gameData.creatorName} wins with the better hand!`;
            }
            
            const isPlayerWinner = (gameState.isCreator && winner === 'creator') || (!gameState.isCreator && winner === 'opponent');
            
            // Show result
            const gameMessage = document.getElementById('gameMessage');
            gameMessage.style.display = 'block';
            gameMessage.textContent = winMessage;
            gameMessage.className = isPlayerWinner ? 'game-message win-message' : 'game-message lose-message';
            
            // Update user stats and balance
            if (isPlayerWinner) {
                updateUserBalance(gameData.pot);
                updatePokerStats(true, gameData.pot - selectedBuyIn);
            } else {
                updatePokerStats(false, -selectedBuyIn);
            }
            
            // Auto-return to lobby after showing result
            setTimeout(() => {
                returnToLobby();
            }, 5000);
        }

        // Update user balance
        async function updateUserBalance(amount) {
            currentUser.balance = (currentUser.balance || 0) + amount;
            localStorage.setItem('familyBettingUser', JSON.stringify(currentUser));
            
            try {
                const { doc, updateDoc } = window.firestoreUtils;
                await updateDoc(doc(window.db, 'users', currentUser.id), {
                    balance: currentUser.balance
                });
                
                document.getElementById('userBalance').textContent = '$' + currentUser.balance.toLocaleString();
            } catch (error) {
                console.error('Error updating balance:', error);
            }
        }

        // Update poker stats
        async function updatePokerStats(won, amount) {
            try {
                const { doc, getDoc, updateDoc } = window.firestoreUtils;
                
                const userDoc = await getDoc(doc(window.db, 'users', currentUser.id));
                if (!userDoc.exists()) return;
                
                const userData = userDoc.data();
                
                // Using existing field structure from database
                const currentWins = userData.blackjackWins || 0;
                const currentLosses = userData.betsLost || 0;
                const currentWinnings = userData.blackjackWinnings || 0;
                
                if (won) {
                    await updateDoc(doc(window.db, 'users', currentUser.id), {
                        blackjackWins: currentWins + 1,
                        blackjackWinnings: currentWinnings + amount
                    });
                    pokerStats.wins++;
                    pokerStats.winnings += amount;
                } else {
                    await updateDoc(doc(window.db, 'users', currentUser.id), {
                        betsLost: currentLosses + 1
                    });
                    pokerStats.losses++;
                }
                
                updateStatsDisplay();
                
            } catch (error) {
                console.error('Error updating poker stats:', error);
            }
        }

        // Spectator functions
        function updateSpectatorList() {
            const spectatorList = document.getElementById('spectatorList');
            const spectatorCount = document.getElementById('spectatorCount');
            
            spectatorCount.textContent = spectators.length;
            spectatorList.innerHTML = '';
            
            if (spectators.length === 0) {
                spectatorList.innerHTML = '<div class="spectator-item">No spectators yet</div>';
                return;
            }
            
            spectators.forEach(spectator => {
                const spectatorDiv = document.createElement('div');
                spectatorDiv.className = 'spectator-item';
                spectatorDiv.textContent = spectator;
                spectatorList.appendChild(spectatorDiv);
            });
        }

        // Hand history functions
        function loadHandHistory() {
            // Load user's overall poker history
            if (!currentUser) return;
            
            try {
                const { collection, query, where, orderBy, getDocs } = window.firestoreUtils;
                
                // For now, create placeholder history
                handHistory = [
                    {
                        players: [currentUser.username, 'Family Member'],
                        winner: currentUser.username,
                        pot: 1000,
                        timestamp: new Date(Date.now() - 3600000),
                        result: 'win'
                    }
                ];
                updateHandHistoryDisplay();
            } catch (error) {
                console.error('Error loading hand history:', error);
            }
        }

        function updateHandHistoryDisplay() {
            const historyList = document.getElementById('handHistoryList');
            historyList.innerHTML = '';
            
            if (handHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #888; padding: 40px;">No hands played yet. Start your first game to see history! üé≤</div>';
                return;
            }
            
            handHistory.forEach(hand => {
                const handDiv = document.createElement('div');
                handDiv.className = 'history-item';
                
                const isWin = hand.winner === currentUser.username;
                const time = hand.timestamp.toDate ? hand.timestamp.toDate().toLocaleString() : new Date(hand.timestamp).toLocaleString();
                
                handDiv.innerHTML = `
                    <div class="history-header">
                        <div class="history-players">vs ${hand.players.find(p => p !== currentUser.username)}</div>
                        <div class="history-result ${isWin ? 'result-win' : 'result-loss'}">
                            ${isWin ? 'WIN' : 'LOSS'}
                        </div>
                    </div>
                    <div class="history-details">
                        <div>Pot: $${hand.pot}</div>
                        <div class="history-date">${time}</div>
                    </div>
                `;
                
                historyList.appendChild(handDiv);
            });
        }

        // Return to lobby
        function returnToLobby() {
            // Stop all timers and listeners
            stopTurnTimer();
            if (gameListener) {
                gameListener();
                gameListener = null;
            }

            // Clear current game reference
            currentGame = null;

            // Reset UI
            document.getElementById('gameLobby').style.display = 'block';
            document.getElementById('pokerTable').style.display = 'none';
            document.getElementById('gameMessage').style.display = 'none';
            document.getElementById('gameControls').style.display = 'none';
            document.getElementById('gameIdDisplay').style.display = 'none';
            document.getElementById('leaveGameBtn').style.display = 'none';
            document.getElementById('handEvaluation').style.display = 'none';

            // Reset game state
            gameState = {
                gameId: null,
                phase: 'waiting',
                pot: 0,
                playerChips: 0,
                opponentChips: 0,
                playerCards: [],
                opponentCards: [],
                communityCards: [],
                currentBet: 0,
                playerBet: 0,
                opponentBet: 0,
                lastAction: null,
                turn: null,
                smallBlind: 25,
                bigBlind: 50,
                dealer: 'creator',
                isCreator: false
            };

            // Refresh available games
            loadAvailableGames();
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Auto-refresh user stats every 30 seconds
        setInterval(updateUserStats, 30000);
        
        // Auto-refresh available games every 15 seconds
        setInterval(() => {
            if (document.getElementById('gameLobby').style.display !== 'none') {
                loadAvailableGames();
            }
        }, 15000);

        // Make functions available globally
        window.createGame = createGame;
        window.joinSpecificGame = joinSpecificGame;
        window.joinGameById = joinGameById;
        window.loadAvailableGames = loadAvailableGames;
        window.returnToLobby = returnToLobby;
        window.toggleFeature = toggleFeature;
        window.sendChatMessage = sendChatMessage;
        window.foldHand = foldHand;
        window.checkHand = checkHand;
        window.callBet = callBet;
        window.raiseBet = raiseBet;
        window.allIn = allIn;
        window.setBetSize = setBetSize;
    </script>
</body>
</html>