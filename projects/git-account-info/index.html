<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Profile Analyzer</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/breadcrumb.css">
    <link rel="stylesheet" href="../../assets/css/loading-states.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --border: #e2e8f0;
            --accent: #3182ce;
            --accent-hover: #2c5aa0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --success: #38a169;
            --warning: #d69e2e;
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-card: #2d3748;
            --text-primary: #ffffff;
            --text-secondary: #cbd5e0;
            --border: #4a5568;
            --accent: #63b3ed;
            --accent-hover: #4299e1;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --success: #68d391;
            --warning: #f6e05e;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle, .track-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .theme-toggle:hover, .track-btn:hover {
            background: var(--accent-hover);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .user-search {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .search-form {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .search-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .search-btn:hover {
            background: var(--accent-hover);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            border: 2px solid var(--border);
            border-top: 2px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fed7d7;
            color: #9b2c2c;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border: 1px solid #feb2b2;
        }

        .profile-header {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--accent);
        }

        .profile-info h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .profile-info p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .profile-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        .repo-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .repo-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .repo-item:last-child {
            border-bottom: none;
        }

        .repo-name {
            font-weight: 500;
            color: var(--accent);
            text-decoration: none;
        }

        .repo-name:hover {
            text-decoration: underline;
        }

        .repo-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .language-tag {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }

        .timeline {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            grid-column: 1 / -1;
        }

        .timeline-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        .timeline-date {
            font-weight: 500;
            color: var(--accent);
            min-width: 100px;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 4rem;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-stats {
                justify-content: center;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .search-form {
                flex-direction: column;
            }

            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body data-theme="light">
    <header class="header">
        <div class="header-content">
            <div class="logo">GitHub Profile Analyzer</div>
            <div class="header-controls">
                <button class="track-btn" onclick="toggleSearch()">Track my account</button>
                <button class="theme-toggle" id="theme-toggle" type="button">üåô</button>
            </div>
        </div>
    </header>

    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb animated" role="navigation" aria-label="Breadcrumb">
        <ol>
            <li><a href="../../index.html"><span class="breadcrumb-icon">üè†</span>Home</a></li>
            <li><a href="../index.html"><span class="breadcrumb-icon">üöÄ</span>Projects</a></li>
            <li><span class="current"><span class="breadcrumb-icon">üêô</span>Git Account Info</span></li>
        </ol>
    </nav>

    <div class="container">
        <div class="user-search" id="userSearch" style="display: none;">
            <form class="search-form" onsubmit="searchUser(event)">
                <input type="text" class="search-input" id="usernameInput" placeholder="Enter GitHub username..." required>
                <button type="submit" class="search-btn">Analyze Profile</button>
            </form>
        </div>

        <div id="content"></div>
    </div>

    <footer class="footer">
        <p><strong>Created by Dan Finn</strong></p>
    </footer>

    <script src="../../assets/js/theme-manager.js"></script>
    <script>
        const API_BASE = 'https://api.github.com';
        const DEFAULT_USER = 'finn1817';
        let currentUser = DEFAULT_USER;
        let userSearchVisible = false;

        function toggleSearch() {
            const searchDiv = document.getElementById('userSearch');
            userSearchVisible = !userSearchVisible;
            searchDiv.style.display = userSearchVisible ? 'block' : 'none';
        }

        function searchUser(event) {
            event.preventDefault();
            const username = document.getElementById('usernameInput').value.trim();
            if (username) {
                currentUser = username;
                loadProfile();
                toggleSearch();
            }
        }

        function showLoading() {
            document.getElementById('content').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing GitHub profile...</p>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }

        async function fetchGitHubData(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                throw new Error(`Failed to fetch data: ${error.message}`);
            }
        }

        async function loadProfile() {
            showLoading();
            
            try {
                const [user, repos, events] = await Promise.all([
                    fetchGitHubData(`/users/${currentUser}`),
                    fetchGitHubData(`/users/${currentUser}/repos?per_page=100&sort=updated`),
                    fetchGitHubData(`/users/${currentUser}/events?per_page=100`)
                ]);

                displayProfile(user, repos, events);
            } catch (error) {
                showError(error.message);
            }
        }

        function displayProfile(user, repos, events) {
            const languages = getLanguageStats(repos);
            const repoStats = getRepoStats(repos);
            const timeline = getTimeline(repos, events);
            const activityStats = getActivityStats(events);

            document.getElementById('content').innerHTML = `
                <div class="profile-header">
                    <img src="${user.avatar_url}" alt="${user.name || user.login}" class="profile-avatar">
                    <div class="profile-info">
                        <h1>${user.name || user.login}</h1>
                        <p>@${user.login}</p>
                        ${user.bio ? `<p>${user.bio}</p>` : ''}
                        ${user.location ? `<p>üìç ${user.location}</p>` : ''}
                        ${user.blog ? `<p><a href="${user.blog}" target="_blank">${user.blog}</a></p>` : ''}
                        <p>Member since ${new Date(user.created_at).getFullYear()}</p>
                        <div class="profile-stats">
                            <div class="stat">
                                <div class="stat-number">${user.public_repos}</div>
                                <div class="stat-label">Repositories</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${user.followers}</div>
                                <div class="stat-label">Followers</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${user.following}</div>
                                <div class="stat-label">Following</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">${repos.reduce((sum, repo) => sum + repo.stargazers_count, 0)}</div>
                                <div class="stat-label">Total Stars</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard">
                    <div class="card">
                        <h3 class="card-title">Language Distribution</h3>
                        <div class="chart-container">
                            <canvas id="languageChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Repository Stats</h3>
                        <div class="chart-container">
                            <canvas id="repoChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Recent Activity</h3>
                        <div>
                            <p><strong>Push Events:</strong> ${activityStats.pushes}</p>
                            <p><strong>Pull Requests:</strong> ${activityStats.pullRequests}</p>
                            <p><strong>Issues:</strong> ${activityStats.issues}</p>
                            <p><strong>Forks:</strong> ${activityStats.forks}</p>
                            <p><strong>Watches:</strong> ${activityStats.watches}</p>
                            <p><strong>Total Events (last 90 days):</strong> ${events.length}</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Repository Showcase</h3>
                        <div class="repo-list">
                            ${repos.sort((a, b) => b.size - a.size).slice(0, 10).map(repo => `
                                <div class="repo-item">
                                    <div>
                                        <a href="${repo.html_url}" target="_blank" class="repo-name">${repo.name}</a>
                                        ${repo.description ? `<p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0.25rem 0;">${repo.description}</p>` : ''}
                                        ${repo.language ? `<span class="language-tag">${repo.language}</span>` : ''}
                                    </div>
                                    <div class="repo-stats">
                                        <span>‚≠ê ${repo.stargazers_count}</span>
                                        <span>üç¥ ${repo.forks_count}</span>
                                        <span>üìù ${repo.size} KB</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <div class="timeline">
                    <h3 class="card-title">Activity Timeline</h3>
                    ${timeline.map(item => `
                        <div class="timeline-item">
                            <div class="timeline-date">${item.date}</div>
                            <div>${item.description}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            createLanguageChart(languages);
            createRepoChart(repoStats);
        }

        function getLanguageStats(repos) {
            const languages = {};
            repos.forEach(repo => {
                if (repo.language) {
                    languages[repo.language] = (languages[repo.language] || 0) + 1;
                }
            });
            return languages;
        }

        function getRepoStats(repos) {
            const totalStars = repos.reduce((sum, repo) => sum + repo.stargazers_count, 0);
            const totalForks = repos.reduce((sum, repo) => sum + repo.forks_count, 0);
            const totalSizeKB = repos.reduce((sum, repo) => sum + repo.size, 0);
            const totalSizeMB = Math.round(totalSizeKB / 1024 * 10) / 10; // Convert to MB with 1 decimal place
            
            return {
                'Total Stars': totalStars,
                'Total Forks': totalForks,
                'Total Size (MB)': totalSizeMB,
                'Public Repos': repos.length
            };
        }

        function getActivityStats(events) {
            const stats = {
                pushes: 0,
                pullRequests: 0,
                issues: 0,
                forks: 0,
                watches: 0
            };

            events.forEach(event => {
                switch(event.type) {
                    case 'PushEvent':
                        stats.pushes++;
                        break;
                    case 'PullRequestEvent':
                        stats.pullRequests++;
                        break;
                    case 'IssuesEvent':
                        stats.issues++;
                        break;
                    case 'ForkEvent':
                        stats.forks++;
                        break;
                    case 'WatchEvent':
                        stats.watches++;
                        break;
                }
            });

            return stats;
        }

        function getTimeline(repos, events) {
            const timeline = [];
            
            // Add account creation
            const sortedRepos = repos.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
            if (sortedRepos.length > 0) {
                timeline.push({
                    date: new Date(sortedRepos[0].created_at).toLocaleDateString(),
                    description: `Created first repository: ${sortedRepos[0].name}`
                });
            }

            // Add recent activity
            const recentEvents = events.slice(0, 10);
            recentEvents.forEach(event => {
                let description = '';
                switch(event.type) {
                    case 'PushEvent':
                        description = `Pushed ${event.payload.commits?.length || 1} commit(s) to ${event.repo.name}`;
                        break;
                    case 'CreateEvent':
                        description = `Created ${event.payload.ref_type} in ${event.repo.name}`;
                        break;
                    case 'PullRequestEvent':
                        description = `${event.payload.action} pull request in ${event.repo.name}`;
                        break;
                    case 'IssuesEvent':
                        description = `${event.payload.action} issue in ${event.repo.name}`;
                        break;
                    default:
                        description = `${event.type.replace('Event', '')} in ${event.repo.name}`;
                }
                
                timeline.push({
                    date: new Date(event.created_at).toLocaleDateString(),
                    description: description
                });
            });

            return timeline.slice(0, 15);
        }

        function createLanguageChart(languages) {
            const ctx = document.getElementById('languageChart').getContext('2d');
            const labels = Object.keys(languages);
            const data = Object.values(languages);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createRepoChart(stats) {
            const ctx = document.getElementById('repoChart').getContext('2d');
            const labels = Object.keys(stats);
            const data = Object.values(stats);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Stats',
                        data: data,
                        backgroundColor: [
                            '#3182ce',
                            '#38a169',
                            '#d69e2e',
                            '#9966ff'
                        ],
                        borderColor: [
                            '#2c5aa0',
                            '#2f855a',
                            '#b7791f',
                            '#805ad5'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return Number.isInteger(value) ? value : value.toFixed(1);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const themeManager = window.themeManager || (typeof ThemeManager !== 'undefined' ? ThemeManager.getInstance?.() : null);
            const toggleBtn = document.getElementById('theme-toggle');

            // Theme manager handles the toggle automatically
            
            if (!themeManager) {
                console.error('ThemeManager is unavailable on the Git Account Info page.');
            }

            loadProfile();
        });
    </script>
</body>
</html>